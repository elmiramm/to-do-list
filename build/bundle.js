(()=>{"use strict";const t=(t,e)=>{localStorage.setItem(t,JSON.stringify(e))},e=t=>JSON.parse(localStorage.getItem(t)),s=document.querySelector(".list"),n=(t,e)=>t.done-e.done!=0?t.done-e.done:t.done?new Date(e.finishDate)-new Date(t.finishDate):new Date(e.createDate)-new Date(t.createDate),a=t=>{let{text:e,done:s,id:n}=t;const a=document.createElement("li");a.classList.add("list-item"),a.setAttribute("data-id",n);const i=(t=>{let{done:e}=t;const s=document.createElement("input");return s.setAttribute("type","checkbox"),s.checked=e,s.classList.add("list-item__checkbox"),s})({done:s});s&&a.classList.add("list-item_done");const c=document.createElement("button");c.classList.add("list-item__delete-btn");const o=document.createElement("span");return o.classList.add("list-item__text"),o.textContent=e,a.append(i,o,c),a},i=()=>{const t=e("tasksList")||[];s.innerHTML="";const i=t.sort(n).map(a);s.append(...i)},c="https://64980b429543ce0f49e1995a.mockapi.io/api/v1/tasks",o=()=>fetch(c).then((t=>t.json())),d=()=>{const e=document.querySelector(".task-input"),s=e.value;if(!s)return;e.value="";var n;(n={text:s,done:!1,createDate:(new Date).toISOString()},fetch(c,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)})).then(o).then((e=>{t("tasksList",e),i()}))},r=s=>{s.target.classList.contains("list-item__checkbox")?(s=>{const n=e("tasksList"),a=s.target.closest(".list-item").dataset.id,{text:d,createDate:r}=n.find((t=>t.id===a)),l=s.target.checked,m={text:d,createDate:r,done:l,finishDate:l?(new Date).toISOString():null};((t,e)=>fetch(`${c}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}))(a,m).then(o).then((e=>{t("tasksList",e),i()}))})(s):s.target.classList.contains("list-item__delete-btn")&&(e=>{var s;(s=e.target.closest(".list-item").dataset.id,fetch(`${c}/${s}`,{method:"DELETE"})).then(o).then((e=>{t("tasksList",e),i()}))})(s)};document.addEventListener("DOMContentLoaded",(()=>{o().then((e=>{t("tasksList",e),i()})),document.querySelector(".create-task-btn").addEventListener("click",d),document.querySelector(".list").addEventListener("click",r)})),window.addEventListener("storage",(t=>{"tasksList"===t.key&&i()}))})();